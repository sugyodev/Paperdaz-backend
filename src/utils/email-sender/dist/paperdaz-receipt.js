"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
exports.__esModule = true;
exports.sendPaperdazReceipt = void 0;
var nodemailer_1 = require("nodemailer");
var app_1 = require("../../app");
var constants_1 = require("../constants");
var email_footer_1 = require("../email-footer");
exports.sendPaperdazReceipt = function (user, attachment) { return __awaiter(void 0, void 0, void 0, function () {
    var sender, footer, html, mail;
    return __generator(this, function (_a) {
        switch (_a.label) {
            case 0:
                sender = nodemailer_1["default"].createTransport({
                    service: 'Mailgun',
                    auth: {
                        user: app_1["default"].get('email_user'),
                        pass: app_1["default"].get('email_password')
                    }
                });
                console.log('here attachment===>', attachment, user.role === constants_1.DEFAULT_VALUES.users.roles.FREE_USER
                    ? user.email
                    : user.companyEmail);
                return [4 /*yield*/, email_footer_1.email_footer()];
            case 1:
                footer = _a.sent();
                html = "\n  <!DOCTYPE HTML\n  PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional //EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\" xmlns:v=\"urn:schemas-microsoft-com:vml\"\n  xmlns:o=\"urn:schemas-microsoft-com:office:office\">\n\n<head>\n  <!--[if gte mso 9]>\n              <xml>\n                <o:OfficeDocumentSettings>\n                  <o:AllowPNG/>\n                  <o:PixelsPerInch>96</o:PixelsPerInch>\n                </o:OfficeDocumentSettings>\n              </xml>\n              <![endif]-->\n  <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <meta name=\"x-apple-disable-message-reformatting\">\n  <!--[if !mso]><!-->\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\"><!--<![endif]-->\n  <link rel=\"stylesheet\" href=\"https://fonts.googleapis.com/icon?family=Material+Icons\">\n  <script src=\"https://cdn.jsdelivr.net/npm/iconify-icon@1.0.0-beta.3/dist/iconify-icon.min.js\"></script>\n  <script src=\"https://code.iconify.design/iconify-icon/1.0.0-beta.3/iconify-icon.min.js\"></script>\n  <title></title>\n\n  <style type=\"text/css\">\n    @media only screen and (min-width: 620px) {\n      .u-row {\n        width: 600px !important;\n      }\n\n      .u-row .u-col {\n        vertical-align: top;\n      }\n\n      .u-row .u-col-33p33 {\n        width: 199.98px !important;\n      }\n\n      .u-col-small {\n        width: 80.98px !important;\n      }\n\n      .u-col-large {\n        width: calc(100% - 80.98px) !important;\n      }\n\n      .u-row .u-col-66p67 {\n        width: 400.02px !important;\n      }\n\n      .u-row .u-col-100 {\n        width: 600px !important;\n      }\n\n    }\n\n    @media (max-width: 620px) {\n      .u-row-container {\n        max-width: 100% !important;\n        padding-left: 0px !important;\n        padding-right: 0px !important;\n      }\n\n      .u-row .u-col {\n        min-width: 320px !important;\n        max-width: 100% !important;\n        display: block !important;\n      }\n\n      .u-row {\n        width: calc(100% - 40px) !important;\n      }\n\n      .u-col {\n        width: 100% !important;\n      }\n\n      .u-col>div {\n        margin: 0 auto;\n      }\n\n      .u-col-small {\n        width: 80.98px !important;\n      }\n\n      .u-col-large {\n        width: calc(100% - 80.98px) !important;\n      }\n    }\n\n    body {\n      margin: 0;\n      padding: 0;\n      background-color: #f9f9f9;\n    }\n\n    table,\n    tr,\n    td {\n      vertical-align: top;\n      border-collapse: collapse;\n    }\n\n    p {\n      margin: 0;\n    }\n\n    .ie-container table,\n    .mso-container table {\n      table-layout: fixed;\n    }\n\n    * {\n      line-height: inherit;\n    }\n\n    a[x-apple-data-detectors='true'] {\n      color: inherit !important;\n      text-decoration: none !important;\n    }\n\n    table,\n    td {\n      color: #000000;\n    }\n\n    a {\n      color: #0000ee;\n      text-decoration: underline;\n    }\n  </style>\n\n\n\n  <!--[if !mso]><!-->\n  <link href=\"https://fonts.googleapis.com/css?family=Cabin:400,700\" rel=\"stylesheet\" type=\"text/css\">\n  <link href=\"https://fonts.googleapis.com/css?family=Open+Sans:400,700\" rel=\"stylesheet\" type=\"text/css\">\n  <!--<![endif]-->\n\n</head>\n\n<body class=\"clean-body u_body\"\n  style=\"margin: 0;padding: 0;-webkit-text-size-adjust: 100%;background: #f9f9f9 !important;color: #000000\">\n  <!--[if IE]><div class=\"ie-container\"><![endif]-->\n  <!--[if mso]><div class=\"mso-container\"><![endif]-->\n  <main style=\"background-color: #f9f9f9; padding:1em 0\">\n    <table\n      style=\"border-radius:20px;width:100%;max-width:600px; border-collapse: collapse;table-layout: fixed;border-spacing: 0;mso-table-lspace: 0pt;mso-table-rspace: 0pt;vertical-align: top;min-width: 320px;Margin: 0 auto;background-color: #f9f9f9;width:100%\"\n      cellpadding=\"0\" cellspacing=\"0\">\n      <tbody>\n        <tr style=\"vertical-align: top\">\n          <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\">\n            <!--[if (mso)|(IE)]><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"><tr><td align=\"center\" style=\"background-color: #f9f9f9;\"><![endif]-->\n\n\n            <div class=\"u-row-container\" style=\"padding: 0px;background:#FFFFFF !important;height: auto;\">\n              <div class=\"u-row\"\n                style=\"Margin: 0 auto;min-width: 320px;max-width: 600px;overflow-wrap: break-word;word-wrap: break-word;word-break: break-word;background-color: #ffffff;\">\n                <div\n                  style=\"border-collapse: collapse;display: table;width: 100%;height: 100%;background-color: transparent;\">\n                  <!--[if (mso)|(IE)]><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"><tr><td style=\"padding: 0px;background-color: #ffffff;\" align=\"center\"><table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"width:600px;\"><tr style=\"background-color: #ffffff;\"><![endif]-->\n\n                  <!--[if (mso)|(IE)]><td align=\"center\" width=\"600\" style=\"background-color: #ffffff;width: 600px;padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;\" valign=\"top\"><![endif]-->\n                  <div class=\"u-col u-col-100\"\n                    style=\"max-width: 320px;min-width: 600px;display: table-cell;vertical-align: top;\">\n                    <div style=\"background-color: #ffffff;height: 100%;width: 100% !important;\">\n                      <!--[if (!mso)&(!IE)]><!-->\n                      <div\n                        style=\"padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;\">\n                        <!--<![endif]-->\n\n                        <table style=\"font-family:'Cabin',sans-serif;\" role=\"presentation\" cellpadding=\"0\"\n                          cellspacing=\"0\" width=\"100%\" border=\"0\">\n                          <tbody>\n                            <tr>\n                              <td\n                                style=\"overflow-wrap:break-word;word-break:break-word;padding:5px;font-family:'Cabin',sans-serif;\"\n                                align=\"left\">\n\n                                <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n                                  <tr>\n                                    <td style=\"padding-right: 0px;padding-left: 0px;\" align=\"center\">\n\n                                      <img align=\"center\" border=\"0\"\n                                        src=\"https://assets.unlayer.com/projects/94341/1659802952531-PAPERDAZ1%20(1).png\"\n                                        alt=\"Image\" title=\"Image\"\n                                        style=\"outline: none;text-decoration: none;-ms-interpolation-mode: bicubic;clear: both;display: inline-block !important;border: none;height: auto;float: none;width: 40%;max-width: 236px;\"\n                                        width=\"236\" />\n\n                                    </td>\n                                  </tr>\n                                </table>\n\n                              </td>\n                            </tr>\n                          </tbody>\n                        </table>\n\n                        <!--[if (!mso)&(!IE)]><!-->\n                      </div><!--<![endif]-->\n                    </div>\n                  </div>\n                  <!--[if (mso)|(IE)]></td><![endif]-->\n                  <!--[if (mso)|(IE)]></tr></table></td></tr></table><![endif]-->\n                </div>\n              </div>\n            </div>\n\n\n\n            <div class=\"u-row-container\" style=\"padding: 0px;background-color: #ffffff\">\n              <div class=\"u-row\"\n                style=\"Margin: 0 auto;min-width: 320px;max-width: 600px;overflow-wrap: break-word;word-wrap: break-word;word-break: break-word;background-color: transparent;\">\n                <div\n                  style=\"border-collapse: collapse;display: table;width: 100%;height: 100%;background-color: transparent;\">\n                  <!--[if (mso)|(IE)]><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"><tr><td style=\"padding: 0px;background-color: #ffffff;\" align=\"center\"><table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"width:600px;\"><tr style=\"background-color: transparent;\"><![endif]-->\n\n                  <!--[if (mso)|(IE)]><td align=\"center\" width=\"600\" style=\"background-color: #ffffff;width: 600px;padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;border-radius: 0px;-webkit-border-radius: 0px; -moz-border-radius: 0px;\" valign=\"top\"><![endif]-->\n                  <div class=\"u-col u-col-100\"\n                    style=\"max-width: 320px;min-width: 600px;display: table-cell;vertical-align: top;\">\n                    <div\n                      style=\"background-color: #ffffff;height: 100%;width: 100% !important;border-radius: 0px;-webkit-border-radius: 0px; -moz-border-radius: 0px;\">\n                      <!--[if (!mso)&(!IE)]><!-->\n                      <div\n                        style=\"padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;border-radius: 0px;-webkit-border-radius: 0px; -moz-border-radius: 0px;\">\n                        <!--<![endif]-->\n\n                        <table style=\"font-family:'Cabin',sans-serif;\" role=\"presentation\" cellpadding=\"0\"\n                          cellspacing=\"0\" width=\"100%\" border=\"0\">\n                          <tbody>\n                            <tr>\n                              <td\n                                style=\"overflow-wrap:break-word;word-break:break-word;padding:10px;font-family:'Cabin',sans-serif;\"\n                                align=\"left\">\n\n                                <table height=\"0px\" align=\"center\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\"\n                                  width=\"100%\"\n                                  style=\"border-collapse: collapse;table-layout: fixed;border-spacing: 0;mso-table-lspace: 0pt;mso-table-rspace: 0pt;vertical-align: top;border-top: 3px solid #77b550;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%\">\n                                  <tbody>\n                                    <tr style=\"vertical-align: top\">\n                                      <td\n                                        style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;font-size: 0px;line-height: 0px;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%\">\n                                        <span>&#160;</span>\n                                      </td>\n                                    </tr>\n                                  </tbody>\n                                </table>\n\n                              </td>\n                            </tr>\n                          </tbody>\n                        </table>\n\n                        <!--[if (!mso)&(!IE)]><!-->\n                      </div><!--<![endif]-->\n                    </div>\n                  </div>\n                  <!--[if (mso)|(IE)]></td><![endif]-->\n                  <!--[if (mso)|(IE)]></tr></table></td></tr></table><![endif]-->\n                </div>\n              </div>\n            </div>\n\n\n\n            <div class=\"u-row-container\" style=\"padding: 0px;background-color: #ffffff\">\n              <div class=\"u-row\"\n                style=\"Margin: 0 auto;min-width: 320px;max-width: 600px;overflow-wrap: break-word;word-wrap: break-word;word-break: break-word;background-color: transparent;\">\n                <div\n                  style=\"border-collapse: collapse;display: table;width: 100%;height: 100%;background-color: transparent;\">\n                  <!--[if (mso)|(IE)]><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"><tr><td style=\"padding: 0px;background-color: #ffffff;\" align=\"center\"><table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"width:600px;\"><tr style=\"background-color: transparent;\"><![endif]-->\n\n                  <!--[if (mso)|(IE)]><td align=\"center\" width=\"600\" style=\"background-color: #ffffff;width: 600px;padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;border-radius: 0px;-webkit-border-radius: 0px; -moz-border-radius: 0px;\" valign=\"top\"><![endif]-->\n                  <div class=\"u-col u-col-100\"\n                    style=\"max-width: 320px;min-width: 600px;display: table-cell;vertical-align: top;\">\n                    <div\n                      style=\"background-color: #ffffff;height: 100%;width: 100% !important;border-radius: 0px;-webkit-border-radius: 0px; -moz-border-radius: 0px;\">\n                      <!--[if (!mso)&(!IE)]><!-->\n                      <div\n                        style=\"padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;border-radius: 0px;-webkit-border-radius: 0px; -moz-border-radius: 0px;\">\n                        <!--<![endif]-->\n\n                        <table style=\"font-family:'Cabin',sans-serif;\" role=\"presentation\" cellpadding=\"0\"\n                          cellspacing=\"0\" width=\"100%\" border=\"0\">\n                          <tbody>\n                            <tr>\n                              <td\n                                style=\"overflow-wrap:break-word;word-break:break-word;padding:15px;font-family:'Cabin',sans-serif;\"\n                                align=\"left\">\n\n                                <div style=\"line-height: 140%; text-align: center; word-wrap: break-word;\">\n                                  <p style=\"font-size: 14px; line-height: 140%;\"><span\n                                      style=\"font-size: 20px; line-height: 28px; font-family: 'Open Sans', sans-serif;\"><strong>Receipt</strong></span>\n                                  </p>\n                                </div>\n\n                              </td>\n                            </tr>\n                          </tbody>\n                        </table>\n\n                        <!--[if (!mso)&(!IE)]><!-->\n                      </div><!--<![endif]-->\n                    </div>\n                  </div>\n                  <!--[if (mso)|(IE)]></td><![endif]-->\n                  <!--[if (mso)|(IE)]></tr></table></td></tr></table><![endif]-->\n                </div>\n              </div>\n            </div>\n\n\n\n            <div class=\"u-row-container\" style=\"padding: 0px;background-color: #ffffff\">\n              <div class=\"u-row\"\n                style=\"Margin: 0 auto;min-width: 320px;max-width: 600px;overflow-wrap: break-word;word-wrap: break-word;word-break: break-word;background-color: #ffffff;\">\n                <div\n                  style=\"border-collapse: collapse;display: table;width: 100%;height: 100%;background-color: transparent;\">\n                  <!--[if (mso)|(IE)]><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"><tr><td style=\"padding: 0px;background-color: #ffffff;\" align=\"center\"><table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"width:600px;\"><tr style=\"background-color: #ffffff;\"><![endif]-->\n\n                  <!--[if (mso)|(IE)]><td align=\"center\" width=\"600\" style=\"width: 600px;padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;\" valign=\"top\"><![endif]-->\n                  <div class=\"u-col u-col-100\"\n                    style=\"max-width: 320px;min-width: 600px;display: table-cell;vertical-align: top;\">\n                    <div style=\"height: 100%;width: 100% !important;\">\n                      <!--[if (!mso)&(!IE)]><!-->\n                      <div\n                        style=\"padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;\">\n                        <!--<![endif]-->\n\n                        <table style=\"font-family:'Cabin',sans-serif;\" role=\"presentation\" cellpadding=\"0\"\n                          cellspacing=\"0\" width=\"100%\" border=\"0\">\n                          <tbody>\n\n                            <tr>\n                              <td\n                                style=\"overflow-wrap:break-word;word-break:break-word;padding:20px 55px;font-family:'Cabin',sans-serif;\"\n                                align=\"left\">\n                                <div style=\"display:flex\">\n                                  <div class=\"u-col-small\" style=\"display: inline-block;flex:none\">\n                                    <img src=\"" + user.profilePicture + "\"\n                                      style=\"width: 55px;height:55px;border-radius:10%;padding: 2px;border: 1px solid #4caf50;object-fit: cover;\" />\n                                  </div>\n                                  <div style=\"line-height: 160%; text-align: left; word-wrap: break-word;\">\n                                    <p style=\"font-size: 14px; line-height: 160%;\"><span\n                                        style=\"font-size: 18px; line-height: 28.8px;color:grey;\">Hi\n                                        " + user.firstName + ",</span></p>\n                                    <p style=\"font-size: 14px; line-height: 160%;\"> </p>\n                                    <p style=\"font-size: 14px; line-height: 160%;\"><span\n                                        style=\"font-size: 18px; line-height: 28.8px;color:grey;\">" + user.lastName + "</span>\n                                    </p>\n                                    <p style=\"font-size: 14px; line-height: 160%;\"> </p>\n                                  </div>\n                                </div>\n                              </td>\n                            </tr>\n\n                          </tbody>\n                        </table>\n                        <p style=\"padding:20px 55px;font-family:'Cabin',sans-serif;color:grey;\">\n                          Attached receipt for your Paperdaz subscription.\n                        </p>\n                        <table style=\"font-family:'Cabin',sans-serif;\" role=\"presentation\" cellpadding=\"0\"\n                          cellspacing=\"0\" width=\"100%\" border=\"0\">\n                          <tbody>\n                            <tr>\n                              <td\n                                style=\"overflow-wrap:break-word;word-break:break-word;padding:10px;color:grey;font-family:'Cabin',sans-serif;\"\n                                align=\"left\">\n\n                                <div align=\"center\">\n                                  <!--[if mso]><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"border-spacing: 0; border-collapse: collapse; mso-table-lspace:0pt; mso-table-rspace:0pt;font-family:'Cabin',sans-serif;\"><tr><td style=\"font-family:'Cabin',sans-serif;\" align=\"center\"><v:roundrect xmlns:v=\"urn:schemas-microsoft-com:vml\" xmlns:w=\"urn:schemas-microsoft-com:office:word\" href=\"\" style=\"height:46px; v-text-anchor:middle; width:203px;\" arcsize=\"8.5%\" stroke=\"f\" fillcolor=\"#77b550\"><w:anchorlock/><center style=\"color:#FFFFFF;font-family:'Cabin',sans-serif;\"><![endif]-->\n\n                                  <!--[if mso]></center></v:roundrect></td></tr></table><![endif]-->\n                                </div>\n\n                              </td>\n                            </tr>\n                          </tbody>\n                        </table>\n  \n\n   " + footer + "\n\n  ";
                mail = {
                    from: app_1["default"].get('email_from'),
                    to: user.role === constants_1.DEFAULT_VALUES.users.roles.FREE_USER
                        ? user.email
                        : user.companyEmail,
                    subject: 'Paperdaz, Payment receipt',
                    attachments: [
                        {
                            filename: 'paperdaz_invoice.pdf',
                            path: attachment
                        }
                    ],
                    html: html
                };
                return [4 /*yield*/, sender.sendMail(mail, function (error, info) {
                        if (error) {
                            console.log(error);
                            return;
                        }
                        else {
                            console.log('Email sent successfully: ' + info.response);
                            //log here
                            return;
                        }
                    })];
            case 2:
                _a.sent();
                return [2 /*return*/];
        }
    });
}); };
